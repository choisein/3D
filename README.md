<분산 IP기반 크리덴셜스터핑 탐지 및 방어>

- 프로젝트 목표
1. 사용자 경각심 증가 => 사용자가 본인 계정의 보안 이슈를 쉽게 확인할 수 있는 대시보드 제작
2. 탐지 효율성 증가 => 로그인 요청 주체가 봇인지 실제 계정 주인인지 탐지 
3. 새로운 방어 기법 => 로봇의 지능이 고도화 됨에 따라 기존 캡차는 우회 가능성이 있고 사용자의 개인정보가 보호되지 않는다는 단점이 있음. 이를 보완한 캡차 제시

- 프로젝트 흐름
1. 분산 ip 기반 대량 로그인 시도
2. 비정상적인 로그인을 탐지하여 사용자 계정으로 알림
3. 탐지 결과를 바탕으로 (0-50: 정상 사용자로 간주, 50-90: 캡차 시행, 90-100: 계정 일시 잠금) 점수별 조치를 취함
4. 캡차는 실현 가능성 제안 및 간단한 시연
5. 공격당한 사용자 계정으로 로그인 => 대시보드에 알림이 뜨고 현재 계정상태, 로그인 기록(일시, 기기, ip, 위치 등) 확인 가능 / 2단계 인증 상시 활성화 버튼, 비밀번호 변경 주기 설정 기능
6. 관리자 페이지 => 
  1)총 로그인 시도 횟수
  2)탐지된 비정상 로그인
  3)캡차 시행 횟수 
  4)자세한 로그 기록 (일시, 기기, ip, 위치, referer, accept-language, 총 점수) 
   (해당 로그 기록 클릭하면 점수에 대한 상세 정보가 나타나고 해당 ip 차단할 수 있도록)
  5)차단된 ip 목록
  6)주요 위험요인을 원그래프(비율)로 나타내기

----------------------------------------------------------------------------------------------------------------------------------------------------------
-보안 로직
1. 탐지 방법
 1) 이전 로그인 기록과 비교하여 일정 기준을 넘어가면 항목별로 점수화하여 최종 위험도를 종합적으로 계산 => 점수가 높을수록 봇으로 간주
 2) 고려 항목
  가. IP => 전에 로그인 했을 때와 지역이 달라졌는가?
   동일 IP: 0
   동일 ASN, 동일 국가(다른 IP): 10
   동일 국가, 다른 도시(합리적인 이동거리): 20
   다른 국가(인접 국가): 50
   다른 대륙 또는 멀리 떨어진 국가 : 90–100
   추가 가중: IP가 VPN/Proxy/Tor/Hosting provider이면 +20

  나. User-Agent => 브라우저 엔진/ os가 달라졌는가?
   동일 브라우저 엔진 + 동일 OS major version: 0
   동일 엔진, 다른 minor 버전: 10
   엔진 변경 (예: Chrome → Firefox) 또는 OS 변경: 40
   엔진/OS 전혀 다른 + 디바이스 타입(Desktop↔Mobile) 변경: 80–100
   비정상/의심 UA (헤드리스 표식 HeadlessChrome, webdriver) → 100

  다. referer => 로그인 페이지까지의 경로가 정상적인가?
   Referer 없음 but 정상 흐름 허용(직접 URL): 0–5
   Referer가 로그인 유도 페이지(홈→로그인): 0
   Referer가 외부/의심 링크(스팸·자동화 유입): 50
   Referer 조작(토큰 불일치·CSRF 검사 실패): 100

  라. accep-language => 이전과 같은 언어를 적용했는가?
   동일 언어 우선순위: 0
   동일 언어 계열(ko→ko-KR vs ko-KR→en-US 작은 변화): 10–20
   완전 다른 언어 우선순위: 40

2. 방어 기법
 1) 사람은 인지할 수 없는 작은 요소를 코드에 심어둔다.(웹 페이지에 보이지 않도록 설정)
 2) 자바스크립트로 이 요소의 속성 값을 짧은 간격으로 변경한다. 
 3) 웹페이지의 코드를 읽어 작동하는 봇은 이 미세한 변화를 감지하려 할 것이고 이에 반응하면 봇으로 간주하여 로그인을 차단한다.

----------------------------------------------------------------------------------------------------------------------------------------------------------

<프로젝트 흐름2>

-1단계: 정상 사용자 프로파일링 (최초 기준점 설정)
최초 로그인: 사용자가 처음 회원가입 후 성공적으로 로그인합니다.
기준 정보 저장: 이때 서버는 해당 사용자의 IP 주소, User-Agent, Referer, Accept-Language 정보를 데이터베이스의 사용자 정보와 함께 
**'최초 프로필'**로 기록해 둡니다. 이것이 앞으로 모든 비교의 기준점이 됩니다.

-2단계: 공격 시뮬레이션
제작한 공격 봇(Selenium 또는 Requests 사용)이 로그인 요청을 보냅니다.
대량 시도: 이때 반복문을 돌며 매번 다른 가짜 IP (X-Forwarded-For 헤더 변조), 다른 브라우저 정보 (User-Agent 문자열 변경) 등으로 자신의 흔적을 계속 바꿉니다.

-3단계: 1차 방어 - 점수 기반 위험 분석
1) 로그인 요청 접수: 서버는 변조된 로그인 요청을 받습니다.
2) 프로필 비교: 서버는 요청 정보와 데이터베이스에 저장된 해당 계정의 '최초 프로필'을 비교합니다.
   => IP가 다른가? / User-Agent가 다른가? / Referer가 없는가? 등등 ...
3) 위험 점수 계산: 위 차이점을 기반으로 '위험 점수(Risk Score)'를 실시간으로 계산합니다.

-4단계: 2차 방어 - 동적 함정으로 유도 (정밀 분석)
조건부 분기: 서버는 계산된 '위험 점수'를 확인합니다.
1)점수가 낮을 경우 (예: 40점 미만): "정상 사용자일 가능성이 높다." → 일반 로그인 페이지를 보여줍니다.
2)점수가 높을 경우 (예: 40점 이상 90점 미만): "봇일 가능성이 매우 높다!" → 겉보기엔 똑같지만, 보이지 않는 DOM 함정이 숨겨진 특수 버전의 페이지를 보여줍니다.
3) (90점 이상): 로그인 차단

-5단계: 최종 판정 및 차단
 -함정 발동: 특수 페이지로 유도된 봇은 페이지를 분석하다가 숨겨진 DOM 함정을 건드리게 됩니다.
 -페이지의 JavaScript는 이 상호작용을 감지하여 "이 사용자는 100% 봇임"이라고 최종 확정합니다.
 => 즉시 차단되거나 영구적으로 격리됩니다.
