// MySQL ì—°ê²° ì‹œë„
//$conn = new mysqli($servername, $username, $password, $dbname);

// ì—°ê²° ì‹¤íŒ¨ ì‹œ ì¢…ë£Œ
//if ($conn->connect_error) {
//    die("âŒ MySQL ì—°ê²° ì‹¤íŒ¨: " . $conn->connect_error);
//}

// ì—°ê²° ì„±ê³µ ì‹œ ë©”ì‹œì§€
//echo "âœ… MySQL ì—°ê²° ì„±ê³µ<br>";


<?php
// ðŸš« PHP ê²½ê³ , ì—ëŸ¬ HTMLë¡œ ì¶œë ¥ë˜ì§€ ì•Šê²Œ ì°¨ë‹¨
error_reporting(0);
ini_set('display_errors', 0);

require_once 'connect.php';

header('Content-Type: application/json; charset=utf-8');

// POSTë¡œ ë°›ì€ ê°’
$id = $_POST['loginId'] ?? '';
$password = $_POST['password'] ?? '';

if (!$id || !$password) {
    echo json_encode(["success" => false, "message" => "ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”."]);
    exit;
}

try {
    // âœ… í…Œì´ë¸” ì´ë¦„ ì •í™•ížˆ í™•ì¸ (IDsave ê¸°ì¤€)
    $stmt = $pdo->prepare("SELECT * FROM IDsave WHERE ID = ?");
    $stmt->execute([$id]);
    $user = $stmt->fetch();

    if ($user && password_verify($password, $user['Password'])) {
        echo json_encode(["success" => true, "message" => "ë¡œê·¸ì¸ ì„±ê³µ"]);
    } else {
        echo json_encode(["success" => false, "message" => "ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."]);
    }

} catch (PDOException $e) {
    // ðŸš¨ PHP ë‚´ë¶€ DB ì—ëŸ¬ë„ JSONìœ¼ë¡œ ë°˜í™˜
    echo json_encode([
        "success" => false,
        "message" => "DB ì˜¤ë¥˜ ë°œìƒ: " . $e->getMessage()
    ]);
}
?>


//login_log.php
<?php
header('Content-Type: application/json; charset=utf-8');
include 'connect.php';

// âœ… POSTë¡œ ì „ë‹¬ë°›ì€ ë°ì´í„°
$usernum = $_POST['usernum'] ?? '';
$ip = $_POST['ip'] ?? '';
$location = $_POST['location'] ?? 'Unknown';

// ê¸°ë³¸ê°’ ê²€ì¦
if (empty($usernum) || empty($ip)) {
    echo json_encode(["success" => false, "message" => "ë¡œê·¸ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."], JSON_UNESCAPED_UNICODE);
    exit;
}

try {
    // ë¡œê·¸ ì €ìž¥
    $usernum = $user['IDnum']; // ì‹¤ì œ í…Œì´ë¸”ì˜ PK
$logStmt = $pdo->prepare("
    INSERT INTO Loginlog (Usernum, IP, location, data)
    VALUES (?, ?, ?, NOW())
");
$logStmt->execute([$usernum, $ip, $location]);


    echo json_encode(["success" => true, "message" => "ë¡œê·¸ ê¸°ë¡ ì™„ë£Œ"], JSON_UNESCAPED_UNICODE);
} catch (PDOException $e) {
    echo json_encode(["success" => false, "message" => "DB ì˜¤ë¥˜: " . $e->getMessage()], JSON_UNESCAPED_UNICODE);
}
?>

SET @count = 0;
UPDATE Loginlog SET lognum = @count := @count + 1 ORDER BY lognum;
ALTER TABLE Loginlog AUTO_INCREMENT = 1;
